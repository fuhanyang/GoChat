<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>é«˜çº§èŠå¤©å®¤</title>
    <link rel="stylesheet" href="/api/static/temp/css/chat.css">
    <link rel="stylesheet" href="/api/static/temp/css/friend.css">
    <link rel="stylesheet" href="/api/static/temp/css/message.css">
    <link rel="stylesheet" href="/api/static/temp/css/textInput.css">
    <link rel="stylesheet" href="/api/static/temp/css/kickModal.css">
    <link rel="stylesheet" href="/api/static/temp/css/notificationModal.css">
</head>

<body>
<!-- ä¼˜åŒ–çš„è¸¢å‡ºç”¨æˆ·å¼¹çª— -->
<div id="kickModalOverlay" class="kick-modal-overlay"></div>
<div id="kickModal" class="kick-modal">
    <div class="kick-modal-header">
        <span class="kick-modal-icon">âš ï¸</span>
        <h3 class="kick-modal-title">ä¼šè¯å·²ç»ˆæ­¢</h3>
        <p class="kick-modal-subtitle">æ‚¨çš„è´¦æˆ·å·²åœ¨å…¶ä»–è®¾å¤‡ç™»å½•</p>
    </div>
    <div class="kick-modal-body">
        <p class="kick-modal-message" id="kickMessage">æ‚¨å·²åœ¨å…¶ä»–è®¾å¤‡ç™»å½•ï¼Œå½“å‰ä¼šè¯å·²ç»ˆæ­¢ã€‚</p>
        <div class="kick-modal-reason" id="kickReason">åŸå› ï¼šæ–°è®¾å¤‡ç™»å½•</div>
        <div class="kick-modal-actions">
            <button class="kick-modal-btn kick-modal-btn-primary" id="kickConfirmBtn">
                é‡æ–°ç™»å½•
            </button>
        </div>
    </div>
</div>

<!-- å‹å¥½æç¤ºå¼¹çª— -->
<div id="notificationModalOverlay" class="notification-modal-overlay"></div>
<div id="notificationModal" class="notification-modal">
    <div class="notification-modal-header">
        <span class="notification-modal-icon" id="notificationIcon">â„¹ï¸</span>
        <h3 class="notification-modal-title" id="notificationTitle">æç¤º</h3>
        <p class="notification-modal-subtitle" id="notificationSubtitle">ç³»ç»Ÿæ¶ˆæ¯</p>
    </div>
    <div class="notification-modal-body">
        <p class="notification-modal-message" id="notificationMessage">è¿™æ˜¯ä¸€æ¡æç¤ºæ¶ˆæ¯</p>
        <div class="notification-modal-actions">
            <button class="notification-modal-btn notification-modal-btn-primary" id="notificationConfirmBtn">
                ç¡®å®š
            </button>
        </div>
    </div>
</div>
<div class="chat-app-container">
    <!-- å·¦ä¾§ï¼šç”¨æˆ·ä¸å¥½å‹åŒº -->
    <aside class="sidebar">
        <section class="user-profile">
            <img id="userAvatar" src="" alt="ç”¨æˆ·å¤´åƒ" class="avatar" onclick="goToUserDetailPage()">
            <script>
                // å®šä¹‰è·å–å¤´åƒçš„å‡½æ•°
                function getUserAvatar() {
                    if (localStorage.getItem('avatar_url') !== null) {
                        return localStorage.getItem('avatar_url');
                    } else {
                        return localStorage.getItem('base_url') + '/api/static/images/user-icon.png'; // é»˜è®¤å¤´åƒ
                    }
                }
                // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
                window.onload = function() {
                    // æ‰¾åˆ° img æ ‡ç­¾
                    const avatarImg = document.getElementById('userAvatar');
                    // è°ƒç”¨å‡½æ•°å¹¶è®¾ç½® src
                    avatarImg.src = getUserAvatar();
                    console.log('imgæ ‡ç­¾æœ€ç»ˆçš„srcï¼š', avatarImg.src); // å…³é”®æ—¥å¿—2ï¼ˆä¼šæ˜¾ç¤ºæµè§ˆå™¨è§£æåçš„å®Œæ•´URLï¼‰
                };
            </script>
            <div class="user-meta">
                <span class="user-nickname" id="userNickname">ç”¨æˆ·å</span>
                <span class="user-account" id="userAccountNum"></span>
                <span class="user-status online" id="userStatus">åœ¨çº¿</span>
            </div>
            <button class="logout-btn" onclick="logoff()">ç™»å‡º</button>
        </section>
        <section class="friend-section">
            <div class="friend-header">
                <input type="text" id="friendSearch" placeholder="è¾“å…¥è´¦å·æ·»åŠ å¥½å‹æˆ–ç•™ç©ºéšæœºåŒ¹é…..." />
                <button class="add-friend-btn" onclick="addFriend()">æ·»åŠ å¥½å‹</button>
                <script>// æœç´¢å¥½å‹åŠŸèƒ½ï¼ˆç®€å•å‰ç«¯è¿‡æ»¤ï¼‰å’ŒåŠ¨æ€æ›´æ–°æŒ‰é’®æ–‡æœ¬
                document.getElementById('friendSearch').addEventListener('input', function() {
                    const keyword = this.value.trim();
                    const addFriendBtn = document.querySelector('.add-friend-btn');

                    // åŠ¨æ€æ›´æ–°æŒ‰é’®æ–‡æœ¬
                    if (keyword) {
                        addFriendBtn.textContent = `é€šè¿‡è´¦å·æœç´¢`;
                    } else {
                        addFriendBtn.textContent = 'éšæœºåŒ¹é…å¥½å‹';
                    }

                    // æœç´¢å¥½å‹åˆ—è¡¨
                    const items = document.querySelectorAll('#friendList li');
                    items.forEach(li => {
                        if (li.textContent.includes(keyword)) {
                            li.style.display = '';
                        } else {
                            li.style.display = 'none';
                        }
                    });
                });</script>
            </div>
            <div class="friend-groups">
                <div class="friend-group" id="defaultGroup">
                    <div class="group-title">æˆ‘çš„å¥½å‹</div>
                    <!-- å¥½å‹åˆ—è¡¨ -->
                    <ul id="friendList"></ul>
                </div>
                <!-- å¯æ‰©å±•åˆ†ç»„ -->
            </div>
        </section>
    </aside>
    <!-- ä¸­é—´ï¼šèŠå¤©ä¸»åŒº -->
    <main class="chat-main">
        <header class="chat-header" id="chatHeader">
            <!-- é€‰ä¸­å¥½å‹æ—¶å¡«å……å¤´åƒå’Œä¿¡æ¯ï¼Œå¦åˆ™æ˜¾ç¤ºæç¤º -->
        </header>
        <section class="message-area">
            <div id="messages"></div>
        </section>
        <footer class="chat-input-area">
            <form id="textInputForm" class="chat-input-form">
                <button type="button" class="emoji-btn" title="è¡¨æƒ…">ğŸ˜Š</button>
                <label for="textInput"></label><textarea id="textInput" placeholder="è¾“å…¥æ¶ˆæ¯..." autocomplete="off" rows="1"></textarea>
                <button type="button" class="file-btn" title="å‘é€æ–‡ä»¶">ğŸ“</button>
                <button type="submit" class="send-btn">å‘é€</button>
            </form>
            <div class="char-counter" id="charCounter">0/1000</div>
            <div id="error"></div>
        </footer>
    </main>
    <!-- å³ä¾§ï¼šä¿¡æ¯åŒºï¼ˆå¯æ‰©å±•ï¼‰ -->
    <aside class="info-panel" id="infoPanel" style="display:none;">
        <div id="infoContent">
            <!-- å¥½å‹èµ„æ–™ã€èŠå¤©è®¾ç½®ç­‰å†…å®¹åŠ¨æ€å¡«å…… -->
        </div>
    </aside>
</div>
<script src="/api/static/js/jwt.js"></script>
<script src="/api/static/js/login.js"></script>
<script src="/api/static/js/friend.js"></script>
<!-- <script src="/api/static/js/websocket-manager.js"></script> -->
<script src="/api/static/js/chat.js"></script>
<!--<script src="/api/static/js/userInfo.js"></script>-->

</body>
</html>